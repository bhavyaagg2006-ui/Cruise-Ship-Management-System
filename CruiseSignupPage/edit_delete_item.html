<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit / Delete Items</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(to right, #050228, #4438b4, #978cfc);
        color: #fff;
        margin: 0;
        padding: 20px;
    }
    h2 {
        border-bottom: 2px solid #444;
        padding-bottom: 5px;
        margin-top: 30px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        background: #021342;
    }
    table, th, td {
        border: 1px solid #b2adad;
    }
    th, td {
        padding: 10px;
        text-align: left;
    }
    img {
        max-width: 80px;
        border-radius: 4px;
    }
    button {
        padding: 6px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 4px;
    }
    .edit-btn { background: #2196f3; color: white; }
    .delete-btn { background: #e53935; color: white; }
    /* Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.7);
        justify-content: center;
        align-items: center;
    }
    .modal-content {
        background: #1e1e1e;
        padding: 20px;
        border-radius: 6px;
        max-width: 400px;
        width: 100%;
    }
    .modal-content label {
        display: block;
        margin-top: 10px;
    }
    .modal-content input, 
    .modal-content textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border-radius: 4px;
        border: 1px solid #555;
        background: #121212;
        color: #fff;
    }
    .modal-actions {
        margin-top: 15px;
        text-align: right;
    }
</style>
</head>
<body>

<h1>Edit / Delete Items</h1>

<div id="data-container"></div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h3>Edit Item</h3>
        <input type="hidden" id="editDocId">
        <input type="hidden" id="editCollection">
        <label>Name</label>
        <input type="text" id="editName">
        <label>Price</label>
        <input type="number" id="editPrice">
        <label>Description</label>
        <textarea id="editDescription"></textarea>
        <label>Image URL</label>
        <input type="text" id="editImageUrl">
        <img id="editImagePreview" style="margin-top:10px; max-width:100%;" />
        <div class="modal-actions">
            <button id="saveEditBtn" class="edit-btn">Save</button>
            <button id="cancelEditBtn" class="delete-btn">Cancel</button>
        </div>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyD0cA756dZeVEbR4Vqovsh5p74niMxNT3w",
      authDomain: "cruise-ship-management-s-98138.firebaseapp.com",
      projectId: "cruise-ship-management-s-98138",
      storageBucket: "cruise-ship-management-s-98138.appspot.com",
      messagingSenderId: "401246402444",
      appId: "1:401246402444:web:dd8a21a7e144e90d3788a9"
    };
   
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Collections & name fields
const collections = [
    { name: "partyHallItems", nameField: "hallName" },
    { name: "cateringItems", nameField: "itemName" },
    { name: "movieResortItems", nameField: "itemName" },
    { name: "fitnessSessions", nameField: "activity" },
    { name: "stationeryItems", nameField: "itemName" },
    { name: "salonServices", nameField: "serviceName" }
];

const container = document.getElementById('data-container');
const modal = document.getElementById('editModal');
const editName = document.getElementById('editName');
const editPrice = document.getElementById('editPrice');
const editDescription = document.getElementById('editDescription');
const editImageUrl = document.getElementById('editImageUrl');
const editImagePreview = document.getElementById('editImagePreview');
const editDocId = document.getElementById('editDocId');
const editCollection = document.getElementById('editCollection');

// Load data for all collections
collections.forEach(col => {
    db.collection(col.name).get().then(snapshot => {
        if (!snapshot.empty) {
            const section = document.createElement('div');
            section.innerHTML = `<h2>${col.name}</h2>`;
            const table = document.createElement('table');
            table.innerHTML = `
                <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            `;
            snapshot.forEach(doc => {
                const data = doc.data();
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><img src="${data.imageUrl || ''}" alt="No Image"></td>
                    <td>${data[col.nameField] || ''}</td>
                    <td>${data.price || ''}</td>
                    <td>${data.description || ''}</td>
                    <td>
                        <button class="edit-btn" onclick="openEdit('${col.name}','${doc.id}','${encodeURIComponent(data[col.nameField] || '')}','${encodeURIComponent(data.price || '')}','${encodeURIComponent(data.description || '')}','${encodeURIComponent(data.imageUrl || '')}')">Edit</button>
                        <button class="delete-btn" onclick="deleteItem('${col.name}','${doc.id}')">Delete</button>
                    </td>
                `;
                table.appendChild(tr);
            });
            section.appendChild(table);
            container.appendChild(section);
        }
    });
});

// Open Edit Modal
function openEdit(collection, docId, name, price, description, imageUrl) {
    editCollection.value = collection;
    editDocId.value = docId;
    editName.value = decodeURIComponent(name);
    editPrice.value = decodeURIComponent(price);
    editDescription.value = decodeURIComponent(description);
    editImageUrl.value = decodeURIComponent(imageUrl);
    editImagePreview.src = decodeURIComponent(imageUrl);
    modal.style.display = 'flex';
}

// Save Edit
document.getElementById('saveEditBtn').addEventListener('click', () => {
    const col = editCollection.value;
    const id = editDocId.value;
    db.collection(col).doc(id).update({
        itemName: editName.value,
        name: editName.value,
        serviceName: editName.value,
        activity: editName.value,
        price: editPrice.value,
        description: editDescription.value,
        imageUrl: editImageUrl.value
    }).then(() => {
        alert("Item updated!");
        location.reload();
    }).catch(err => console.error(err));
});

// Cancel Edit
document.getElementById('cancelEditBtn').addEventListener('click', () => {
    modal.style.display = 'none';
});

// Live image preview in modal
editImageUrl.addEventListener('input', () => {
    editImagePreview.src = editImageUrl.value;
});

// Delete item
function deleteItem(collection, docId) {
    if (confirm("Are you sure you want to delete this item?")) {
        db.collection(collection).doc(docId).delete().then(() => {
            alert("Item deleted!");
            location.reload();
        }).catch(err => console.error(err));
    }
}
</script>
</body>
</html>
