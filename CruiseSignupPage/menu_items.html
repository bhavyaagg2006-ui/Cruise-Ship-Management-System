<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maintain Catering Menu</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #21022e;
        color: #fff;
        margin: 0;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
        color: #ffcc00;
    }
    .form-container, .table-container {
        background: #1d023c;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(232, 217, 217, 0.5);
        margin-bottom: 20px;
    }
    label {
        font-weight: bold;
        display: block;
        margin-top: 10px;
    }
    input, textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: none;
        border-radius: 5px;
        background: #310347;
        color: #fff;
    }
    button {
        margin-top: 15px;
        padding: 10px 15px;
        background-color: #ffcc00;
        border: none;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
    }
    button:hover {
        background-color: #e6b800;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td {
        padding: 10px;
        border-bottom: 1px solid #333;
        text-align: left;
    }
    th {
        background-color: #270137;
    }
    img {
        max-width: 60px;
        border-radius: 5px;
    }
    .actions button {
        margin-right: 5px;
        padding: 5px 8px;
    }
    .cancel-btn {
        background-color: #ff4d4d;
    }
    .cancel-btn:hover {
        background-color: #e60000;
    }
</style>
</head>
<body>

<h1>Maintain Catering Menu</h1>

<div class="form-container">
    <h2 id="form-title">Add New Item</h2>
    <label>Item Name</label>
    <input type="text" id="itemName">

    <label>Price</label>
    <input type="number" id="price">

    <label>Description</label>
    <textarea id="description"></textarea>

    <label>Image URL</label>
    <input type="text" id="imageUrl" placeholder="Enter image link">

    <img id="previewImage" src="" style="display:none; margin-top:10px; max-width:100px;">

    <button id="saveBtn">Add Item</button>
    <button id="cancelBtn" class="cancel-btn" style="display:none;">Cancel</button>
</div>

<div class="table-container">
    <h2>Existing Menu Items</h2>
    <table>
        <thead>
            <tr>
                <th>Image</th>
                <th>Item Name</th>
                <th>Price</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="itemsTable"></tbody>
    </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyD0cA756dZeVEbR4Vqovsh5p74niMxNT3w",
    authDomain: "cruise-ship-management-s-98138.firebaseapp.com",
    projectId: "cruise-ship-management-s-98138",
    storageBucket: "cruise-ship-management-s-98138.appspot.com",
    messagingSenderId: "401246402444",
    appId: "1:401246402444:web:dd8a21a7e144e90d3788a9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let editId = null;

// Live preview of image
document.getElementById("imageUrl").addEventListener("input", e => {
    const url = e.target.value;
    const img = document.getElementById("previewImage");
    if(url) {
        img.src = url;
        img.style.display = "block";
    } else {
        img.style.display = "none";
    }
});

// Fetch and display items
function loadItems() {
    db.collection("cateringItems").orderBy("itemName").onSnapshot(snapshot => {
        const table = document.getElementById("itemsTable");
        table.innerHTML = "";
        snapshot.forEach(doc => {
            const data = doc.data();
            table.innerHTML += `
                <tr>
                    <td><img src="${data.imageUrl}" alt=""></td>
                    <td>${data.itemName}</td>
                    <td>â‚¹${data.price}</td>
                    <td>${data.description}</td>
                    <td class="actions">
                        <button onclick="editItem('${doc.id}','${data.itemName}','${data.price}','${data.description}','${data.imageUrl}')">Edit</button>
                        <button class="cancel-btn" onclick="deleteItem('${doc.id}')">Delete</button>
                    </td>
                </tr>
            `;
        });
    });
}
loadItems();

// Add or update item
document.getElementById("saveBtn").addEventListener("click", () => {
    const name = document.getElementById("itemName").value.trim();
    const price = document.getElementById("price").value.trim();
    const desc = document.getElementById("description").value.trim();
    const imageUrl = document.getElementById("imageUrl").value.trim();

    if(!name || !price || !desc || !imageUrl) {
        alert("Please fill all fields");
        return;
    }

    const itemData = { itemName: name, price: parseFloat(price), description: desc, imageUrl };

    if(editId) {
        db.collection("cateringItems").doc(editId).update(itemData).then(() => {
            resetForm();
        });
    } else {
        db.collection("cateringItems").add(itemData).then(() => {
            resetForm();
        });
    }
});

// Edit item
function editItem(id, name, price, desc, imageUrl) {
    editId = id;
    document.getElementById("itemName").value = name;
    document.getElementById("price").value = price;
    document.getElementById("description").value = desc;
    document.getElementById("imageUrl").value = imageUrl;
    document.getElementById("previewImage").src = imageUrl;
    document.getElementById("previewImage").style.display = "block";
    document.getElementById("form-title").textContent = "Edit Item";
    document.getElementById("saveBtn").textContent = "Update Item";
    document.getElementById("cancelBtn").style.display = "inline-block";
}

// Delete item
function deleteItem(id) {
    if(confirm("Are you sure you want to delete this item?")) {
        db.collection("cateringItems").doc(id).delete();
    }
}

// Reset form
document.getElementById("cancelBtn").addEventListener("click", resetForm);
function resetForm() {
    editId = null;
    document.getElementById("itemName").value = "";
    document.getElementById("price").value = "";
    document.getElementById("description").value = "";
    document.getElementById("imageUrl").value = "";
    document.getElementById("previewImage").style.display = "none";
    document.getElementById("form-title").textContent = "Add New Item";
    document.getElementById("saveBtn").textContent = "Add Item";
    document.getElementById("cancelBtn").style.display = "none";
}
</script>

</body>
</html>
